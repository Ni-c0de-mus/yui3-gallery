YUI.add("gallery-itsamodelsyncpromise",function(e,t){"use strict";var n=e.Model,r=e.Object,i=e.Array,s="destroy",o="load",u="save",a="error",f="delete",l="read",c=s+"ed",h="_published",p=function(t){if(typeof t=="string")try{return e.JSON.parse(t)}catch(n){return this.fire(a,{error:n,response:t,src:"parse"}),{}}return t||{}};n.prototype.destroy=function(e,t){var n=this,r;return(r=n.destroyPromise(e))&&t&&r.then(function(e){t(null,e)},function(e){t(e)}),n},n.prototype.destroyPromise=function(e){return this._createPromise(s,e)},n.prototype.load=function(e,t){var n=this,r;return(r=n.loadPromise(e))&&t&&r.then(function(e){t(null,e)},function(e){t(e)}),n},n.prototype.loadPromise=function(e){return this._createPromise(o,e)},n.prototype.publishAsync=function(t,n){var r=this,i=this.publish(t,n);i._firing=new e.Promise(function(e){e()}),i.fire=function(t){var n=e.Array(arguments,0,!0);i._firing=i._firing.then(function(){i.details=n;var e=i._subscribers,s=[],o,u,a;s.push.apply(s,t),o=i._createFacade(s);if(e)for(u=0,a=e.length;u<a;++u)e[u].fn.call(e[u].context,o);return o.prevented?i.preventedFn.call(r,o).then(null,function(e){return!1}):i.defaultFn.call(r,o).then(function(){e=i._afters;for(u=0,a=e.length;u<a;++u)e[u].fn.call(e[u].context,o)}).then(null,function(e){return!1})},function(e){var t={error:e,src:"Model.publishAsync()"};r._lazyFireErrorEvent(t)})},i._fire=function(e){return i.fire(e[0])}},n.prototype.save=function(e,t){var n=this,r;return(r=n.savePromise(e))&&t&&r.then(function(e){t(null,e)},function(e){t(e)}),n},n.prototype.savePromise=function(e){return this._createPromise(u,e)},n.prototype._createPromise=function(t,n){var i=this,s,o,u,a;return s=new e.Promise(function(e,t){o=e,u=t}),a={promise:s,promiseResolve:o,promiseReject:u,response:"",parsed:{}},typeof n=="object"&&r.each(n,function(e,t){a[t]=e}),i[h+t]||(i[h+t]=i.publishAsync(t,{defaultTargetOnly:!0,emitFacade:!0,defaultFn:i["_defFn_"+t],preventedFn:i._prevDefFn})),i.fire(t,a),s},n.prototype._defFn_destroy=function(e){var t=this,n=e.promiseResolve,r=e.promiseReject,s=e.options,o=e.remove||e[f],u,a,l;return t.get(c)?r(new Error("Model is already destroyed")):(l=function(){t._baseDestroy(),i.each(t.lists.concat(),function(e){e.remove(t,s)})},o?(u=function(e){var n={error:e,src:"Model.destroyPromise()",options:s};t._lazyFireErrorEvent(n),r(new Error(e))},a=function(e){l(),n(e)},t.syncPromise?t._syncTimeoutPromise(f,s).then(a,u):t.sync(f,s,function(e,t){e?u(e):a(t)})):(l(),n())),e.promise},n.prototype._defFn_load=function(e){var t=this,n=e.options,r,i,s={options:n};return r=function(n){s.error=n,s.src="Model.loadPromise()",t._lazyFireErrorEvent(s),e.promiseReject(new Error(n))},i=function(r){var i;e.response=r,i=p(r),i.responseText&&(i=i.responseText),e.parsed=i,t.setAttrs(i,n),t.changed={},e.promiseResolve(r)},t.syncPromise?t._syncTimeoutPromise(l,n).then(i,r):t.sync(l,n,function(e,t){e?r(e):i(t)}),e.promise},n.prototype._defFn_save=function(e){var t=this,n=t.isNew()?"create":"update",i=e.options,s=e.promiseReject,o,u,a={options:i,method:n};return t._validate(t.toJSON(),function(f){f?(a.error=f,a.src="Model.savePromise() - validate",t._lazyFireErrorEvent(a),s(new Error(f))):(o=function(e){a.error=e,a.src="Model.savePromise()",t._lazyFireErrorEvent(a),s(new Error(e))},u=function(n){var s;e.response=n,s=p(n),s.responseText&&(s=s.responseText),r.keys(s).length>0&&(e.parsed=s,s.id===-1?t.destroy():t.setAttrs(s,i)),t.changed={},e.promiseResolve(n)},t.syncPromise?t._syncTimeoutPromise(n,i).then(u,o):t.sync(n,i,function(e,t){e?o(e):u(t)}))}),e.promise},n.prototype._prevDefFn=function(e){e.promiseReject(new Error("preventDefaulted"))},n.prototype._lazyFireErrorEvent=function(e){var t=this;t._errorEvent||(t._errorEvent=t.publish(a,{broadcast:1})),t.fire(a,e)},n.prototype._syncTimeoutPromise=function(t,n){var r=this,i;return i=r.syncPromise(t,n),i instanceof e.Promise||(i=new e.Promise(function(e,n){var r="syncPromise is rejected --> "+t+" not defined as a Promise inside syncPromise()";n(new Error(r))})),i}},"gallery-2013.09.25-18-27",{requires:["yui-base","base-base","base-build","node-base","json-parse","promise","model"]});
