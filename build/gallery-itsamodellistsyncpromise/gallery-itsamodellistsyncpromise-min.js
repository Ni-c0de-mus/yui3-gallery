YUI.add("gallery-itsamodellistsyncpromise",function(e,t){"use strict";var n=e.ModelList,r=e.Array,i=e.Object,s="_published",o="read",u="append",a=o+u,f="_defFn_",l="error",c="save",h="submit",p="load",d=p+u,v="destroy",m=v+"models",g="Promise",y=function(t){if(typeof t=="string")try{return e.JSON.parse(t)}catch(n){return this.fire(l,{error:n,response:t,src:"parse"}),{}}return t||{}};r.each([p,d,c,h,m],function(e){n.prototype[e]=function(t,n){var r=this,i;return(i=r[e+g](t))&&n&&i.then(function(e){n(null,e)},function(e){n(e)}),r},n.prototype[e+g]=function(t){return this._createPromise(e,t)}}),n.prototype._createPromise=function(t,n){var r=this,o,u,a,l;return o=new e.Promise(function(e,t){u=e,a=t}),l={promise:o,promiseResolve:u,promiseReject:a,response:"",parsed:{},options:e.merge(n)},typeof n=="object"&&i.each(n,function(e,t){l[t]=e}),r[s+t]||(r[s+t]=r._publishAsync(t,{defaultTargetOnly:!0,emitFacade:!0,defaultFn:r[f+t],preventedFn:r._prevDefFn})),r.fire(t,l),o},n.prototype[f+m]=function(t){var n=this,r=[],i=t.options;return n.each(function(e){r.push(e.destroyPromise(i))}),e.batch.apply(e,r).then(function(e){t.promiseResolve(e)},function(e){t.promiseReject(new Error(e))}),t.promise},r.each([p,d],function(e){n.prototype[f+e]=function(t){var n=this,r=e===d?a:o,i=t.options,s,u;return s=function(r){var s={options:i,error:r,src:e};n._lazyFireErrorEvent(s),t.promiseReject(new Error(r))},u=function(r){var s;t.response=r,s=y(r),s.responseText&&(s=s.responseText),t.parsed=s,e===d||i.append?n.add(s,i):n.reset(s,i),t.promiseResolve(r)},n.syncPromise?n._syncTimeoutPromise(r,i).then(u,s):n.sync(r,i,function(e,t){e?s(e):u(t)}),t.promise}}),n.prototype[f+c]=function(t){var n=this,r=[],i=t.options;return n.each(function(e){e.isModified()&&r.push(e.savePromise(i))}),e.batch.apply(e,r).then(function(e){t.promiseResolve(e)},function(e){t.promiseReject(new Error(e))}),t.promise},n.prototype[f+h]=function(t){var n=this,r=[],i=t.options;return n.each(function(e){e.submitPromise&&r.push(e.submitPromise(i))}),e.batch.apply(e,r).then(function(e){t.promiseResolve(e)},function(e){t.promiseReject(new Error(e))}),t.promise},n.prototype._lazyFireErrorEvent=function(e){var t=this;t._errorEvent||(t._errorEvent=t.publish(l,{broadcast:1})),t.fire(l,e)},n.prototype._publishAsync=function(t,n){var r=this,i=this.publish(t,n);i._firing=new e.Promise(function(e){e()}),i.fire=function(t){var n=e.Array(arguments,0,!0),s={id:i.id,next:i,silent:i.silent,stopped:0,prevented:0,bubbling:null,type:i.type,defaultTargetOnly:i.defaultTargetOnly},o;i._firing=i._firing.then(function(){i.details=n;var e=i._subscribers,u=[],a,f,l;u.push.apply(u,t),a=i._createFacade(u),a.target=a.target||r;if(e)for(f=0,l=e.length;f<l;++f)try{e[f].fn.call(e[f].context,a)}catch(c){}return i.bubbles&&!i.stopped&&(r.bubble(i,n,null,s),a.prevented=Math.max(a.prevented,s.prevented)),a.prevented?i.preventedFn.call(r,a).then(null,function(e){return!1}):i.defaultFn.call(r,a).then(function(){e=i._afters;if(e)for(f=0,l=e.length;f<l;++f)try{e[f].fn.call(e[f].context,a)}catch(t){}if(s.afterQueue)while(o=s.afterQueue.last())o()}).then(null,function(e){return!1})},function(e){var t={error:e&&(e.message||e),src:"ModelList._publishAsync()"};r._lazyFireErrorEvent(t)})},i._fire=function(e){return i.fire(e[0])}},n.prototype._prevDefFn=function(e){e.promiseReject(new Error("preventDefaulted"))},n.prototype._syncTimeoutPromise=function(t,n){var r=this,i;return i=r.syncPromise(t,n),i instanceof e.Promise||(i=new e.Promise(function(e,n){var r="syncPromise is rejected --> "+t+" not defined as a Promise inside syncPromise()";n(new Error(r))})),i},n.prototype.destroyPromise=n.prototype.destroyModelPromise},"gallery-2013.10.02-20-26",{requires:["yui-base","base-base","base-build","node-base","json-parse","promise","model","model-list","gallery-itsamodelsyncpromise"]});
