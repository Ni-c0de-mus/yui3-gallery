YUI.add("gallery-itsaviewmodelpanel",function(e,t){"use strict";var n,r=e.ITSAFormElement,i=e.Array,s=e.Lang,o=4e3,u="id",a="destroyed",f="contentBox",l="rendered",c="gallery-",h="View",p="body"+h,d="footer",v=d+h,m="template",g=d+"Template",y="itsa-focused",b="editable",w="model",E="focused",S="visible",x="Change",T="close",N="click",C=T+N,k="button",L=k+":hide",A="boolean",O="string",M="load",_="submit",D="delete",P="save",H="destroy",B="value",j="reset",F="focusManaged",I="itsatabkeymanager",q="noHideOnLoad",R="noHideOnReset",U="disabled",z="pure-"+k+"-"+U,W="focusnext",X={ok:!0,retry:!0,save:!0,submit:!0};n=e.ITSAViewModelPanel=e.Base.create("itsaviewmodelpanel",e.ITSAPanel,[],null,{ATTRS:{bodyView:{value:null,writeOnce:!0},editable:{value:!1,validator:function(e){return typeof e===A}},focusManaged:{value:!0,validator:function(e){return typeof e===A}},footerTemplate:{value:null,validator:function(e){return typeof e===O}},footerView:{value:null,writeOnce:!0},headerView:{value:null,readOnly:!0},hideOnBtn:{value:!0,validator:function(e){return typeof e===A}},noHideOnLoad:{value:!0,validator:function(e){return typeof e===A}},noHideOnReset:{value:!0,validator:function(e){return typeof e===A}},model:{value:{},validator:function(t){return t===null||s.isObject(t)||typeof t===O||t instanceof e.Model}},template:{value:null,validator:function(e){return typeof e===O}}}}),n.prototype.initializer=function(){var t=this,n=t.get(w),r=t.get(g);t._eventhandlers=[],t._set(p,new e.ITSAViewModel({model:n,template:t.get(m),editable:t.get(b),styled:!1,focusManaged:!1,partOfMultiView:!0})),r&&t._set(v,new e.ITSAViewModel({model:n,template:r,editable:!1,styled:!1,focusManaged:!1,partOfMultiView:!0})),t.publish(W,{defaultFn:e.bind(t._defFn_focusnext,t),emitFacade:!0}),t.get(S)&&t.get(f).addClass(y)},n.prototype.addCustomBtn=function(e,t,n){var r=this,i=r.get(p),s=r.get(v);i.addCustomBtn(e,t,n),s&&s.addCustomBtn(e,t,n)},n.prototype.bindUI=function(){var t=this,i=t.get(f),s,a,l;n.superclass.bindUI.apply(t),s=t._eventhandlers,a=t.get(p),a.addTarget(t),l=t.get(v),l&&l.addTarget(t),t._setFocusManager(t.get(F)),s.push(t.after(b+x,function(e){a.set(b,e.newVal)})),s.push(t.after(S+x,function(n){var i=n.newVal,s;i||(t._pickerVis&&e.ItsaDateTimePicker.hide(!0),s=t.get(w),s.toJSONUI&&(r.tipsyOK._lastnode&&s._FORM_elements[r.tipsyOK._lastnode.get(u)]&&r.tipsyOK.hideTooltip(),r.tipsyInvalid._lastnode&&s._FORM_elements[r.tipsyInvalid._lastnode.get(u)]&&r.tipsyInvalid.hideTooltip())),t.get(f).toggleClass(y,i)})),s.push(t.after(w+x,function(e){var n=t.get(v);a.set(w,e.newVal),n&&n.set(w,e.newVal)})),s.push(t.after(m+x,function(e){a.set(m,e.newVal),i.pluginReady(I,o).then(function(e){e.refresh(i),i.hasClass(y)&&e.focusInitialItem()})})),s.push(t.after("*:viewrendered",function(n){var r=n.target,s=r===t.get(v);s&&(t._footercont.toggleClass("itsa-inlinefooter",!0),r.get("container").get("parentNode").setStyle("overflow","visible"),t._body.setStyle("minWidth",t._footer.get("offsetWidth")+"px"),t._footercont.toggleClass("itsa-inlinefooter",!1)),e.later(250,null,function(){i.pluginReady(I,o).then(function(e){e.refresh(i),i.hasClass(y)&&t.get(S)&&!t._locked&&e.focusInitialItem()})})})),s.push(t.after(F+x,function(e){t._setFocusManager(e.newVal)})),s.push(a.on(W,function(e){if(e.target!==t){var n=W,r={type:n,model:t.get(w),modelEventFacade:e,target:t};t.fire(n,r)}})),s.push(t.after(["*:"+C,"*:"+k+T],function(e){t.fire(L,{buttonNode:e.target})})),s.push(t.after(E+x,function(e){var n=e.newVal&&t.get(S);t.get(f).toggleClass(y,n),n&&i.pluginReady(I,o).then(function(e){e._retreiveFocus()})})),s.push(t.after(["*:"+M,"*:"+j],function(n){var r=n.target;r instanceof e.Model&&t.get(S)&&i.pluginReady(I,o).then(function(e){r.enableUI(),i.hasClass(y)&&e.focusInitialItem()})})),s.push(t.on(g+x,function(n){var r=n.newVal,s=n.prevVal,u;r&&!s&&(u=new e.ITSAViewModel({model:t.get(w),template:r,editable:!1,styled:!1,focusManaged:!1,partOfMultiView:!0}),t._set(v,u),u.addTarget(t),t._renderFooter()),s&&!r&&s.destroy()&&t._set(v,null),i.pluginReady(I,o).then(function(e){e.refresh(i),i.hasClass(y)&&e.focusInitialItem()})})),s.push(t.after(["*:"+N],function(e){var n=e.buttonNode,r=n&&n.get(B);n&&t.get("hideOnBtn")&&r!==T&&(!t.get(R)||r!==j)&&(!t.get(q)||r!==M)&&t.fire(L,{buttonNode:n})})),s.push(t._header.delegate(N,function(e){var n=e.target,r=n.get(B);t.get("hideOnBtn")&&r!==T&&(!t.get(R)||r!==j)&&(!t.get(q)||r!==M)&&t.fire(L,{buttonNode:n})},k)),s.push(t.on(L,function(e){var n=t.get(w),r=t.get(b),i=e.buttonNode,s=i.get(B);X[s]&&r&&n&&n.toJSONUI&&!n.validated()&&e.preventDefault()})),s.push(t.on(["*:"+_,"*:"+P,"*:"+M,"*:"+H],function(n){var r=n.promise,s=n.target,u=n.type.split(":")[1],a=n.options,f=u===H&&(a.remove||a[D]),l;if(!f&&s instanceof e.Model){if(u===_||u===P)l=s.getAttrs(),s.UIToModel();t._lockedBefore=t._locked,t.lockPanel(!0),t._setSpin(u,!0),u===H||r.then(function(){(u===M||u===_||u===P)&&s.setResetAttrs()},function(){return(u===_||u===P)&&s.setAttrs(l,{fromInternal:!0}),!0}).then(function(){t._setSpin(u,!1),t._lockedBefore||t.unlockPanel(),i.hasClass(y)&&i.pluginReady(I,o).then(function(e){e.focusInitialItem()})})}})),s.push(t.on("*:datepickerclick",function(){t.lockPanel(),t._pickerVis=!0,t.once("*:"+W,function(){t._pickerVis=!1,t.unlockPanel()})}))},n.prototype.lockPanel=function(){var e=this,t=e.get(p),n=e.get(v);t.lockView(),n?n.lockView():e._footercont.all("button").addClass(z),arguments[0]||(e._locked=!0)},n.prototype.unlockPanel=function(){var e=this,t=e.get(p),n=e.get(v);t.unlockView(),n?n.unlockView():e._footercont.all("button").removeClass(z),e._locked=!1},n.prototype.removeButtonLabel=function(e){var t=this,n=t.get(p),r=t.get(v);n.removeButtonLabel(e),r&&r.removeButtonLabel(e)},n.prototype.removeCustomBtn=function(e){var t=this,n=t.get(p),r=t.get(v);n.removeCustomBtn(e),r&&r.removeCustomBtn(e)},n.prototype.removeHotKey=function(e){var t=this,n=t.get(p),r=t.get(v);n.removeHotKey(e),r&&r.removeHotKey(e)},n.prototype.setButtonLabel=function(
e,t){var n=this,r=n.get(p),i=n.get(v);r.setButtonLabel(e,t),i&&i.setButtonLabel(e,t)},n.prototype.setHotKey=function(e,t){var n=this,r=n.get(p),i=n.get(v);r.setHotKey(e,t),i&&i.setHotKey(e,t)},n.prototype.syncUI=function(){var e=this,t=e.get(p),n=e.get(v);e.get(l)&&(t.render(),n&&n.render())},n.prototype.translate=function(e){return this.get(p).translate(e)},n.prototype.destructor=function(){var e=this,t=e.get(f),n=e.get(p),r=e.get(v);e._clearEventhandlers(),n.removeTarget(e),t.hasPlugin(I)&&t.unplug(I),n&&n.destroy(),r&&r.destroy()},n.prototype._clearEventhandlers=function(){var e=this;i.each(e._eventhandlers,function(e){e.detach()})},n.prototype._defFn_focusnext=function(){var e=this,t=e.get(f);t.hasClass(y)&&t.pluginReady(I,o).then(function(e){e.next()},function(){})},n.prototype._setFocusManager=function(t){var n=this,r=n.get(f),i=r.itsatabkeymanager;t?e.use(c+I,function(){n.get(a)||(i?i.refresh(r):(r.plug(e.Plugin.ITSATabKeyManager),i=r.itsatabkeymanager),r.hasClass(y)&&i.focusInitialItem())}):i&&r.unplug(I)},n.prototype._setSpin=function(e,t){var n=this,r=n.get(f).all('[data-buttonsubtype="'+e+'"] i');r.toggleClass("itsaicon-form-loading",t),r.toggleClass("itsa-busy",t)}},"gallery-2013.10.09-22-56",{requires:["gallery-itsapluginpromise","node-pluginhost","base-build","base-base","event-outside","model","gallery-itsapanel","gallery-itsaviewmodel","gallery-itsaformelement"]});
