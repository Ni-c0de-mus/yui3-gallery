YUI.add("gallery-pathogen-encoder",function(e,t){function v(){this.tree={weight:Number.MAX_VALUE,path:"/",children:{}}}var n=e.Loader.prototype.resolve,r="p/",s=";",o="+",u=",",a=/-(min|debug).js/,f=/\.(?:js|css)$/,l=/^(?:yui:)?gallery-([^\/]+)/,c={js:!0,css:!0},h,p,d;e.Loader.prototype.buildCombo=function(e,t,n){var r=t,i=t.length+n.length,a,f,l,c,h,d,v,m;for(m=0,v=e.length;m<v;m+=1){d=e[m],a=r===t?"":s,f=d.key,c=d.modules;while(c.length){l=a+f,l=l?l+o:u,d.key.indexOf("path")===0&&(l=a),h=l+c[0];if(!(i+h.length<p))return r+n;r+=h,i+=h.length,c.shift(),a=f=""}}return r+=n,r.length===t.length+n.length&&(r=null),r},e.Loader.prototype.aggregateGroups=function(t){var n={},r,i,s,u,a,c,h,p,m;for(m=0,p=t.length;m<p;m+=1){c=t[m],a=c.name,u=this.groups&&this.groups[c.group];if(u){if(!u.combine||c.fullpath)continue}else if(!this.combine)continue;if(!c.combine&&c.ext)continue;if(!c.group)h="c"+o+YUI.version;else if(c.group==="gallery")d||(r=l.exec(this.groups.gallery.root),d=r&&r[1]),a=a.split("gallery-").pop(),h="g"+o+d;else{if(c.path.indexOf(a+"/"+a)!==0){s=s||new v,s.add(c.path.split(f).shift());continue}h=u.root,h[0]==="/"&&(h=h.slice(1)),h[h.length-1]==="/"&&(h=h.slice(0,-1)),h="r"+o+h}n[h]=n[h]||[],n[h].push(a),e.config.customComboFallback&&(c.group==="gallery"&&(a="gallery-"+a),this.pathogenSeen[a]=!0)}if(s){i=s.compress();for(m=0,p=i.length;m<p;m+=1)h="p"+o+i[m].root,n[h]=n[h]||[],n[h].push(i[m].name);s.destroy(),s=null}return n},v.prototype={add:function(e){var t=this.tree,n=e.split("/"),r=[],i,s,o,u;while(n.length)u=n.shift(),o=t.children[u],r.push(u),i=n.join("/"),o?o.weight+=1+i.length:(s=r.join("/"),o=t.children[u]={path:s,weight:0},i?(o.weight+=s.length+1+i.length,o.children={}):o.weight=Number.MAX_VALUE),t=o},compress:function(){var e=[],t=[],n,r,i,s,o,u,a,f,l;for(f in this.tree.children)this.tree.children.hasOwnProperty(f)&&e.push(this.tree.children[f]);while(e.length){o=0,n=[],a=e.pop(),s=2+a.weight;for(f in a.children)a.children.hasOwnProperty(f)&&(u=a.children[f],o+=n.length?3:2,o+=u.weight,n.push(u));if(s<=o){r=new RegExp("^"+a.path+"/"),i=this.getLeafNodes(a);for(l=0;l<i.length;l+=1)t.push({name:i[l].path.replace(r,""),root:a.path})}else e=e.concat(n)}return JSON,t},getLeafNodes:function(e){var t=[],n,r;if(!e.children)return t.push(e),t;for(r in e.children)e.children.hasOwnProperty(r)&&(n=e.children[r],t=t.concat(this.getLeafNodes(n)));return t},destroy:function(){this.tree=null},stringify:function(){return JSON&&JSON.stringify(this.tree,null,4)}},e.Loader.prototype.sortAggregatedGroups=function(e){var t=[],n,r,i;for(n in e)e.hasOwnProperty(n)&&t.push({key:n,modules:e[n]});t.sort(function(e,t){return e.key>t.key});for(i=0,r=t.length;i<r;i+=1)t[i].modules.sort();return t},e.Loader.prototype.customResolve=function(t,n){var r=this.aggregateGroups(t),i=this.sortAggregatedGroups(r),s=[],o,u,f,l;u||(f=a.exec(e.config.loaderPath),u=f&&f[1]||"raw",u=n==="css"&&u==="debug"?"raw":"min",o=u==="min"?"":"."+u,o=o+"."+n),l=this.buildCombo(i,h,o);while(l)s.push(l),l=this.buildCombo(i,h,o);return s},e.Loader.prototype.shouldFallback=function(e){var t,n,r;if(this.fallbackMode)return this.fallbackMode;for(r in c)if(c.hasOwnProperty(r)){t=e[r+"Mods"];for(i=0,len=t.length;i<len;i+=1){n=t[i].name;if(this.pathogenSeen[n])return this.fallbackMode=!0,this.fallbackMode}}},e.Loader.prototype.resolve=function(){var t=n.apply(this,arguments),i=this.combine,s,o,u,a,f,l,d,v,m,g,y;if(!i)for(d in this.groups)if(this.groups.hasOwnProperty(d)&&!i&&d.combine){i=d.combine;break}e.config.customComboBase&&(h=e.config.customComboBase+r);if(e.config.customComboFallback){this.pathogenSeen=this.pathogenSeen||{};if(this.shouldFallback(t))return t}if(h&&i){p=this.maxURLLength;for(v in c){if(!c.hasOwnProperty(v))continue;a=[],f=v,l=v+"Mods",t[f]=s=t[f]||[],t[l]=o=t[l]||[];for(y=0,g=s.length;y<g;y+=1)m=s[y],(typeof m=="object"||typeof m=="string"&&m.indexOf("/combo?")===-1)&&a.push(m);u=this.customResolve(o,v),JSON,t[v]=[].concat(u,a)}}return t}},"@BETA@",{requires:["loader-base"]});
