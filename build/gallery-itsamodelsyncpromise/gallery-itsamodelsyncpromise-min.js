YUI.add("gallery-itsamodelsyncpromise",function(e,t){"use strict";function a(){}var n=e.Array,r="error",i="submit",s="load",o="save",u=function(t){var n;try{n=e.JSON.parse(t)}catch(r){}return n};e.mix(a.prototype,{submitPromise:function(t){var n=this;return t=t||{},new e.Promise(function(e,r){n.sync("submit",t,function(s,o){var u={options:t,response:o};s?(u.error=s,u.src="Model.submitPromise()",n._lazyFireErrorEvent(u),r(new Error(s))):(n._submitEvent||(n._submitEvent=n.publish(i,{preventable:!1})),n.fire(i,u),e(o,t))})})},loadPromise:function(t){var n=this;return t=t||{},new e.Promise(function(e,r){n.sync("read",t,function(i,o){var a,f={options:t,response:o};i?(f.error=i,f.src="Model.loadPromise()",n._lazyFireErrorEvent(f),r(new Error(i))):(n._loadEvent||(n._loadEvent=n.publish(s,{preventable:!1})),a=f.parsed=u(o),n.setAttrs(a,t),n.changed={},n.fire(s,f),e(o,t))})})},savePromise:function(t){var n=this;return t=t||{},new e.Promise(function(e,r){var i={options:t,src:"save"};n._validate(n.toJSON(),function(s){s?(i.error=s,i.scr="Model.savePromise() - validate",n._lazyFireErrorEvent(i),r(new Error(s))):n.sync(n.isNew()?"create":"update",t,function(s,a){var f;i.response=a,s?(i.error=s,i.src="Model.savePromise()",n._lazyFireErrorEvent(i),r(new Error(s))):(n._saveEvent||(n._saveEvent=n.publish(o,{preventable:!1})),f=i.parsed=u(a),n.setAttrs(f,t),n.changed={},n.fire(o,i),e(a,t))})})})},destroyPromise:function(t){var r=this;return t=t||{},(new e.Promise(function(e,i){r.onceAfter("destroy",function(){function s(){n.each(r.lists.concat(),function(e){e.remove(r,t)})}t.remove||t["delete"]?r.sync("delete",t,function(n){if(n){var o={error:n,src:"Model.destroyPromise()",options:t};r._lazyFireErrorEvent(o),i(new Error(n))}else s(),e(t)}):(s(),e(t))})})).then(function(){e.Model.superclass.destroy.call(r)})},_lazyFireErrorEvent:function(e){var t=this;t._errorEvent||(t._errorEvent=t.publish(r,{broadcast:1})),t.fire(r,e)}},!0),e.ITSAModelSyncPromise=a,e.Base.mix(e.Model,[a])},"gallery-2013.06.20-02-07",{requires:["yui-base","base-base","base-build","node-base","json-parse","promise","model"]});
