YUI.add("gallery-itsaviewmodelpanel",function(e,t){"use strict";var n,r=e.ITSAFormElement,i=e.Lang,s="id",o="destroyed",u="contentBox",a="rendered",f="gallery-",l="View",c="body"+l,h="footer",p=h+l,d="template",v=h+"Template",m="itsa-focused",g="editable",y="model",b="focused",w="visible",E="Change",S="close",x="click",T=S+x,N="button",C=N+":hide",k="boolean",L="string",A="load",O="submit",M="delete",_="save",D="destroy",P="value",H="reset",B="focusManaged",j="itsatabkeymanager",F="noHideOnLoad",I="noHideOnReset",q="disabled",R="pure-"+N+"-"+q,U="focusnext",z={ok:!0,retry:!0,save:!0,submit:!0};n=e.ITSAViewModelPanel=e.Base.create("itsaviewmodelpanel",e.ITSAPanel,[],null,{ATTRS:{bodyView:{value:null,writeOnce:!0},editable:{value:!1,validator:function(e){return typeof e===k}},focusManaged:{value:!0,validator:function(e){return typeof e===k}},footerTemplate:{value:null,validator:function(e){return typeof e===L}},footerView:{value:null,writeOnce:!0},headerView:{value:null,readOnly:!0},hideOnBtn:{value:!0,validator:function(e){return typeof e===k}},noHideOnLoad:{value:!0,validator:function(e){return typeof e===k}},noHideOnReset:{value:!0,validator:function(e){return typeof e===k}},model:{value:{},validator:function(t){return t===null||i.isObject(t)||typeof t===L||t instanceof e.Model}},template:{value:null,validator:function(e){return typeof e===L}}}}),n.prototype.initializer=function(){var t=this,n=t.get(y),r=t.get(v);t._eventhandlers=[],t._set(c,new e.ITSAViewModel({model:n,template:t.get(d),editable:t.get(g),styled:!1,focusManaged:!1,partOfMultiView:!0})),r&&t._set(p,new e.ITSAViewModel({model:n,template:r,editable:!1,styled:!1,focusManaged:!1,partOfMultiView:!0})),t.publish(U,{defaultFn:e.bind(t._defFn_focusnext,t),emitFacade:!0}),t.get(w)&&t.get(g)&&t.get(u).addClass(m)},n.prototype.addCustomBtn=function(e,t,n){var r=this,i=r.get(c),s=r.get(p);i.addCustomBtn(e,t,n),s&&s.addCustomBtn(e,t,n)},n.prototype.bindUI=function(){var t=this,i=t.get(u),o,a,f;n.superclass.bindUI.apply(t),o=t._eventhandlers,a=t.get(c),f=t.get(p),a.addTarget(t),t._setFocusManager(t.get(B)),o.push(t.after(g+E,function(e){a.set(g,e.newVal),t.get(u).toggleClass(m,e.newVal&&t.get(w))})),o.push(t.after(w+E,function(n){var i=n.newVal,o;i||(t._pickerVis&&e.ItsaDateTimePicker.hide(!0),o=t.get(y),o.toJSONUI&&(r.tipsyOK._lastnode&&o._FORM_elements[r.tipsyOK._lastnode.get(s)]&&r.tipsyOK.hideTooltip(),r.tipsyInvalid._lastnode&&o._FORM_elements[r.tipsyInvalid._lastnode.get(s)]&&r.tipsyInvalid.hideTooltip())),t.get(u).toggleClass(m,i&&t.get(g))})),o.push(t.after(v+E,function(e){f.set(d,e.newVal)})),o.push(t.after(y+E,function(e){a.set(y,e.newVal),f.set(y,e.newVal)})),o.push(t.after(d+E,function(e){a.set(d,e.newVal)})),o.push(t.after("*:viewrendered",function(){e.later(250,null,function(){var e=i.itsatabkeymanager;e&&(e.refresh(i),t.get(w)&&!t._locked&&e.focusInitialItem())})})),o.push(t.after(B+E,function(e){t._setFocusManager(e.newVal)})),o.push(a.on(U,function(e){if(e.target!==t){var n=U,r={type:n,model:t.get(y),modelEventFacade:e,target:t};t.fire(n,r)}})),o.push(t.after(["*:"+T,"*:"+N+S],function(e){t.fire(C,{buttonNode:e.target})})),o.push(t.after(b+E,function(e){var n=i.itsatabkeymanager,r=e.newVal&&t.get(w)&&t.get(g);t.get(u).toggleClass(m,r),r&&n&&n._retreiveFocus()})),o.push(t.after(["*:"+A,"*:"+H],function(n){var r=i.itsatabkeymanager,s=n.target;s instanceof e.Model&&r&&t.get(w)&&(s.enableUI(),r.focusInitialItem())})),o.push(t.after(v+E,function(n){var r=n.newVal,i=n.prevVal;r&&!i&&t._set(p,new e.ITSAViewModel({model:t.get(y),template:r,editable:!1,styled:!1,focusManaged:!1,partOfMultiView:!0})),i&&!r&&i.destroy()&&t._set(p,null)})),o.push(t.after(["*:"+x],function(e){var n=e.buttonNode,r=n&&n.get(P);n&&t.get("hideOnBtn")&&r!==S&&(!t.get(I)||r!==H)&&(!t.get(F)||r!==A)&&t.fire(C,{buttonNode:n})})),o.push(t._header.delegate(x,function(e){var n=e.target,r=n.get(P);t.get("hideOnBtn")&&r!==S&&(!t.get(I)||r!==H)&&(!t.get(F)||r!==A)&&t.fire(C,{buttonNode:n})},N)),o.push(t.on(C,function(e){var n=t.get(y),r=t.get(g),i=e.buttonNode,s=i.get(P);z[s]&&r&&n&&n.toJSONUI&&!n.validated()&&e.preventDefault()})),o.push(t.on(["*:"+O,"*:"+_,"*:"+A,"*:"+D],function(n){var r=n.promise,s=n.target,o=n.type.split(":")[1],u=n.options,a=o===D&&(u.remove||u[M]),f;if(!a&&s instanceof e.Model){if(o===O||o===_)f=s.getAttrs(),s.UIToModel();t._lockedBefore=t._locked,t.lockPanel(!0),t._setSpin(o,!0),o===D||r.then(function(){(o===A||o===O||o===_)&&s.setResetAttrs()},function(){return(o===O||o===_)&&s.setAttrs(f,{fromInternal:!0}),!0}).then(function(){var e=i.itsatabkeymanager;t._setSpin(o,!1),t._lockedBefore||t.unlockPanel(),e&&e.focusInitialItem()})}})),o.push(t.on("*:datepickerclick",function(){t.lockPanel(),t._pickerVis=!0,t.once("*:"+U,function(){t._pickerVis=!1,t.unlockPanel()})}))},n.prototype.lockPanel=function(){var e=this,t=e.get(c),n=e.get(p);t.lockView(),n?n.lockView():e._footercont.all("button").addClass(R),arguments[0]||(e._locked=!0)},n.prototype.unlockPanel=function(){var e=this,t=e.get(c),n=e.get(p);t.unlockView(),n?n.unlockView():e._footercont.all("button").removeClass(R),e._locked=!1},n.prototype.removeButtonLabel=function(e){var t=this,n=t.get(c),r=t.get(p);n.removeButtonLabel(e),r&&r.removeButtonLabel(e)},n.prototype.removeCustomBtn=function(e){var t=this,n=t.get(c),r=t.get(p);n.removeCustomBtn(e),r&&r.removeCustomBtn(e)},n.prototype.removeHotKey=function(e){var t=this,n=t.get(c),r=t.get(p);n.removeHotKey(e),r&&r.removeHotKey(e)},n.prototype.setButtonLabel=function(e,t){var n=this,r=n.get(c),i=n.get(p);r.setButtonLabel(e,t),i&&i.setButtonLabel(e,t)},n.prototype.setHotKey=function(e,t){var n=this,r=n.get(c),i=n.get(p);r.setHotKey(e,t),i&&i.setHotKey(e,t)},n.prototype.syncUI=function(){var e=this,t=e.get(c),n=e.get(p);e.get(a)&&(t.render(),n&&n.render())},n.prototype.translate=function(e){return this.get(c).translate(e)},n.prototype.destructor=function(){var e=this,t=e.get(u),n=e.get(c),r=e.get(p);e._clearEventhandlers(),n.removeTarget(e),t.
hasPlugin(j)&&t.unplug(j),n&&n.destroy(),r&&r.destroy()},n.prototype._defFn_focusnext=function(){var e=this,t=e.get(u).itsatabkeymanager;t&&t.next()},n.prototype._setFocusManager=function(t){var n=this,r=n.get(u),i=r.itsatabkeymanager;t?e.use(f+j,function(){n.get(o)||(i?i.refresh(r):(r.plug(e.Plugin.ITSATabKeyManager),i=r.itsatabkeymanager),r.hasClass(m)&&i.focusInitialItem())}):i&&r.unplug(j)},n.prototype._setSpin=function(e,t){var n=this,r=n.get(u).all('[data-buttonsubtype="'+e+'"] i');r.toggleClass("itsaicon-form-loading",t),r.toggleClass("itsa-busy",t)}},"gallery-2013.10.02-20-26",{requires:["node-pluginhost","base-build","base-base","event-outside","model","gallery-itsapanel","gallery-itsaviewmodel"]});
